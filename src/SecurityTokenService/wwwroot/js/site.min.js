function initError(){const n=getQueryValue("errorId");switch(n){case"4001":$("#message").text("不支持双因素认证");break;case"4002":$("#message").text("用户被禁止登录");break;case"4003":$("#message").text("用户被锁定");break;case"4004":$("#message").text("用户名或密码不正确");break;case"4005":$("#message").text("不支持 NativeClient");break;case"4006":$("#message").text("返回地址不合法");break;case"4007":$("#message").text("选择的操作不正确")}}function initRedirect(){const n=decodeURIComponent(getQueryValue("redirectUrl")),t=$("#meta");t.attr("content","0;url="+n);t.attr("data-url",n);window.location.href=n}function initConsent(){const n=getQueryValue("returnUrl");$.ajax({xhrFields:{withCredentials:!0},type:"GET",url:"consent?returnUrl="+n,success:function(n){const t=n.data;if($("#clientName").prepend(t.clientName),t.clientLogoUrl?$("#clientLogoUrl").attr("src",t.clientLogoUrl):$("#clientLogoUrl").remove(),$("#returnUrl").val(t.returnUrl),t.identityScopes&&t.identityScopes.length>0){for(let n=0;n<t.identityScopes.length;++n){const i=t.identityScopes[n];appendScope("identityScopeList",i)}$("#identityScopes").show()}if(t.resourceScopes&&t.resourceScopes.length>0){for(let n=0;n<t.resourceScopes.length;++n){const i=t.resourceScopes[n];appendScope("resourceScopes",i)}$("#resourceScopes").show()}t.allowRememberConsent?$("#rememberConsentDiv").show():$("#rememberConsent").val(!1);t.clientUrl&&($("#client").attr("href",t.clientUrl),$("#clientName2").text(t.clientName))},error:function(){}})}function appendScope(n,t){const i=`<li class="list-group-item">
<label>
 <input class="consent-scopecheck" type="checkbox"
    name="ScopesConsented"
    id="scopes_${t.name}"
    value="${t.name}"
    ${t.checked?'checked="checked"':""}
    ${t.required?'disabled="disabled"':""} />
    <strong>${t.displayName}</strong>
    ${t.required?'<input type="hidden" name="ScopesConsented" value="'+t.name+'"/>':""}
</label>
${scope.required ? '<span><em>(required)</em></span>' : ''}
${scope.description ? '<div class="consent-description"><label for="scopes_' + scope.name + '">' + scope.description + '</label></div>' : ''}
</li>`;$("#"+n).append(i)}function initDiagnostics(){$.ajax({xhrFields:{withCredentials:!0},type:"GET",url:"diagnostics",success:function(n){if(n.claims&&n.claims.length>0){const t=$("#claims");for(let i=0;i<n.claims.length;++i){const r=n.claims[i];t.append(`<dt>${r.type}</dt>`);t.append(`<dd>${r.value}</dd>`)}}if(n.properties&&n.properties.length>0){const t=$("#properties");for(let i=0;i<n.properties.length;++i){const r=n.properties[i];t.append(`<dt>${r.key}</dt>`);t.append(`<dd>${r.value}</dd>`)}}},error:function(n){n.status===401&&(window.location.href="login.html?returnUrl=/diagnostics.html")}})}function initLoggedOut(){const n=getQueryValue("postLogoutRedirectUri"),i=getQueryValue("clientName"),t=getQueryValue("signOutIframeUrl"),r=getQueryValue("automaticRedirectAfterSignOut");n&&($("#clientName").text(i),$("#postLogoutRedirect").show(),r&&(window.location=n));t&&($("#signOutIframe").show(),$("#signOutIframeUrl").attr("src",t))}function initLogin(){$.validator.setDefaults({errorContainer:"div.error",errorLabelContainer:$("#form div.error"),wrapper:"label"});$("#button").click(function(){const n=$("#message");n.hide();$("#form").validate({rules:{username:{required:!0},password:{required:!0}},messages:{username:{required:"用户名不能为空"},password:{required:"请输入密码"}},submitHandler:function(t){$.ajax({xhrFields:{withCredentials:!0},type:"POST",url:"account/login",data:$(t).serialize()+"&returnUrl="+getQueryValue("returnUrl"),beforeSend:function(){},success:function(t){if(t.code===301||t.code===302){const n=t.data;if(n){let t=window;while(t!==t.top)t=t.top;console.log("redirect: "+n);t.location.href=n}}else if(t.code!==200){n.show();switch(t.code){case 4001:n.text("不支持双因素认证");break;case 4002:n.text("用户被禁止登录");break;case 4003:n.text("用户被锁定");break;case 4004:n.text("用户名或密码不正确");break;case 4005:n.text("不支持 NativeClient");break;case 4006:n.text("返回地址不合法")}}else window.location.href="/"},error:function(){console.log("error")}})}})})}function initLogout(){const n=getQueryValue("logoutId");$("#logoutId").val(n)}function initSession(){$.get("session",n=>{if(n.data&&n.data.sub){const t=$("#user");t.attr("sub",n.data.sub);t.prepend(n.data.name);$("#userNav").show()}})}function getQueryValue(n){const i=decodeURI(window.location.search.substring(1)),t=i.split("&");for(let i=0;i<t.length;i++){const r=t[i].split("=");if(r[0]===n)return r[1]}return""}$(document).ready(()=>{$.ajaxSetup({complete:function(n,t){if(t.status===301||t.status===302){const n=t.getResponseHeader("Location");if(n){let t=window;while(t!==t.top)t=t.top;t.location.href=n}}}});const n=location.href;n.indexOf("login.html")>=0?initLogin():n.indexOf("logout.html")>=0?initLogout():n.indexOf("loggedout.html")>=0?initLoggedOut():n.indexOf("diagnostics.html")>=0?(initSession(),initDiagnostics()):n.indexOf("consent.html")>=0?(initSession(),initConsent()):n.indexOf("redirect.html")>=0?initRedirect():n.indexOf("error.html")>=0?(initSession(),initError()):initSession()});